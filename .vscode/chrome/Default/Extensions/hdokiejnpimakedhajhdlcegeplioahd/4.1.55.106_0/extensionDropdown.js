ExtensionDropdown=function(e){var t=$(e.body),n=e.getElementById("items"),o=e.getElementById("searchResults"),i=e.getElementById("recentSites"),a=e.getElementById("identitiesMenuItem"),l=e.getElementById("matchingSitesTopLevel"),r=e.getElementById("matchingSites"),s=$("#topLevelContainer"),c=$("#vaultMenuItem"),u=$("#addOmariaItems"),p=$("#allItems"),d=$("#groupLabel"),g=$("#backButton"),m=$("#debugconsole"),f=$("#encryptedExportMenuItem"),b=$("#wifiExportMenuItem"),v=$("#matchingSitesMenuItem"),P=$("#recentSitesMenuItem"),h=$("#container"),I=$("#searchInput"),y=$("#applicationsMenuItem"),L=null,T=function(){var e=null,t=null;return function(){var n=h.outerHeight(),o=h.outerWidth();n===e&&o===t||(e=n,t=o,LPPlatform.setDropdownPopoverSize(n,o))}}(),S=null,C=null,_=null,E=null,w=null,M=null,x=null,D=null,k=!1,A=!1,F=!1,O=!1,N={},R=null,B={},H=[],K={},z=function(e){if(d.empty(),e){var t=e.getName();t=t.replace(/\\/g," \\ ");var n=t.indexOf("\\",t.length/2);if(-1===n&&(n=t.lastIndexOf("\\")),n>0){var o=LPTools.createElement("div","textOverflowContainer groupLabel");o.appendChild(LPTools.createElement("span",null,t.substring(0,n))),d.append(LPTools.createElement("span","textTail","Â "+t.substring(n))),d.append(o),LPTools.setupMiddleEllipsis(d)}else d.append(LPTools.createElement("span","groupLabel",t));d.find(".groupLabel").attr("title",e.toString())}};K.GroupState=function(e){var t=LPTools.getNavIndex();this.pop=function(){e.rebuildItems(),LPTools.setNavIndex(t),z(e._model)}},K.SearchState=function(){var e=new K.CSSState("searchItem",{restoreKeyboardNav:!1});this.pop=function(){ie(),e.pop()}},K.TopLevelMatchingSitesState=function(e){var t=new K.CSSState("matchingSites"),n=new K.GroupState(e);this.pop=function(){n.pop(),t.pop()}},K.CSSState=function(){var e=t.attr("class"),n=function(n){t.removeClass(e),t.addClass(n),e=n};return function(t,o){var i=e;n(t),LPTools.getOption(o,"applyKeyboardNav",!0)&&LPTools.addKeyBoardNavigation($(".extensionMenuItem:visible"),{selectFirst:!0}),this.pop=function(){z(null),n(i),LPTools.getOption(o,"restoreKeyboardNav",!0)&&LPTools.addKeyBoardNavigation($(".extensionMenuItem:visible")),o&&"function"==typeof o.onPop&&o.onPop()}}}();var V=function(){LPTools.parseUserSpecificMenu(e.getElementById("mainMenu"),LPProxy.getAccountClass()),$("#username").text(bg.get("g_username"))},G=function(){var e=bg.get("LPContentScriptFeatures").ziggy,t=bg.get("LPContentScriptFeatures").omaria;L={isZiggySet:e,isOmarSet:t,showHelpText:e};var n=function(){U(),Q(),ne(L),V(),setTimeout(function(){Z(L,0)}),e||($("#mainMenu").addClass("showIcons"),j()),bg.sendLpImprove("openicondropdown")},o=LPPlatform.getExtensionDropdownDelay();o>=0?setTimeout(n,o):n()},U=function(){h.addClass("loading")},j=function(){T(),h.addClass("initialized"),LPTools.addKeyBoardNavigation($(".extensionMenuItem:visible")),I.focus()},W=function(){LPFeatures.updateFeatures({import:!0,noexport:!1,show_notes:!0,hideidentities:!1,show_formfills:!0})},Z=function(e){LPProxy.initializeModel(),X(e),q(e),A=!0,h.removeClass("loading");for(var t in B)B[t]();var n=I.val();n&&ae(n)},Y=function(e,t){var t=t||{};return LPProxy.getPreference("showAcctsInGroups",!0)&&(e=LPProxy.assignItemsToGroups(e,!1),t.separateFavorites=!0),new Container(e,t)},q=function(e){bg.get("LPContentScriptFeatures").omaria?(itemsContainer=new Container(LPProxy.getAllItems(),$.extend({},e,{omarItems:!0})),itemsContainer.setElement(n),J()):(_=Y(LPProxy.getSites(),e),_.setElement(n),E=Y(LPProxy.getNotes(),e),E.setElement(n),w=new Container(LPProxy.getFormFills(),e),w.setElement(n),M=new Container(LPProxy.getApplications(),e),M.setElement(n)),D=new Container(LPProxy.getAllItems(),$.extend({},e,{moreOptionsState:K.SearchState}))},J=function(){var e=LPProxy.getRecordConfig(),t=LPProxy.getAllModelTypes();e.viewConfig.forEach(function(n){if(n.forEach(function(n){if("all"!==n){var o=LPProxy.getConfigViewObject(n);o.types.forEach(function(n){var i=LPProxy.getConfigTypeObject(n);if(o.default||t.includes(i.noteType)){var a=LPTools.createElement("li",{class:"extensionMenuItem omariaItem",value:i.noteType||i.dataType,childview:"omariaItems"},o.name),l=LPTools.createElement("div","more"),r=LPTools.createElement("i",e.icons[i.id]+" menuIcon");a.appendChild(r),a.appendChild(l),p.append(a)}var s=LPTools.createElement("li",{class:"extensionMenuItem addOmariaItem",value:i.noteType||i.dataType},i.name),c=LPTools.createElement("i",e.icons[i.id]+" menuIcon");s.appendChild(c),u.append(s)})}}),n!==e.viewConfig[0]&&n!==e.viewConfig[e.viewConfig.length-1]){if(!p[0].lastChild.classList.contains("omarSpacer")){var o=LPTools.createElement("li","omarSpacer");p.append(o)}var i=LPTools.createElement("li","omarSpacer");u.append(i)}}),$(".omariaItem").bind("click",function(e){fe(ce(e.target)),se(e),itemsContainer._buildOptions.currentType=e.target.getAttribute("value"),itemsContainer.rebuildItems(n),ye(itemsContainer,"Empty_Site.png",Strings.translateString("Remember everything"))}),$(".addOmariaItem").bind("click",function(e){bg.get_selected_tab_data_no_extension(null,function(t){bg.lpevent("m_add");var n=e.target.getAttribute("value");"Account"===n?pe({defaultData:{url:t?t.url:""}}):de({title:Strings.translateString("Add %1",n),defaultData:{notetype:n}}),LPPlatform.closePopup()}),e.stopPropagation()})},Q=function(){m.LP_removeAttr("style"),f.LP_removeAttr("style"),b.LP_removeAttr("style"),y.LP_removeAttr("style"),bg.is_user_debug_enabled()&&m.show(),bg.have_binary()&&(f.show(),bg.LPPlatform.isWin()&&b.show()),LPTools.hasProperties(bg.get("g_applications"))&&y.show()},X=function(t){if(C=LPProxy.getIdentities(),LPProxy.enableCurrentIdentity(C),C.length>0){le(S);for(var n=[],o=0,i=C.length;o<i;++o)n.push(C[o].newDisplayObject());new IdentityContainer(n,t).initialize(e.getElementById("identities"))}else $(a).hide()},ee=function(e){return!0===N[e]},te=function(e,t,n){for(var o=[],i=0,a=R.length;i<a;++i){var l=R[i].aid;"account"===R[i].type?o.push(new MatchingAccountDisplay(LPProxy.getSiteModel(l))):"note"===R[i].type&&o.push(new MatchingNoteDisplay(LPProxy.getNoteModel(l)))}var r=new Container(o,t);r.setElement(e),r.rebuildItems()},ne=function(t){R=bg.getmatchingsites(!1,!0,!1);for(var n=0,o=R.length;n<o;++n)N[R[n].aid]=!0;t.isZiggySet||LPProxy.getPreference("toplevelmatchingsites",!1)?(P.addClass("divider"),c.addClass("divider"),s.removeClass("hidden"),R.length>2?c.addClass("topLevelMatchesShadow"):(c.removeClass("topLevelMatchesShadow"),0===R.length&&(c.removeClass("divider"),s.addClass("hidden"))),re("topLevelMatchingSites",function(){te(l,$.extend({},t,{autoExpandSingleItem:!1,moreOptionsElement:e.getElementById("matchingSites"),moreOptionsState:K.TopLevelMatchingSitesState,addLastClass:!1,sortFunction:VaultItemBaseDisplay.prototype.sortOmarMatchingItems})),j()})()):(0===R.length?v.LP_removeAttr("style"):(v.show(),$("#matchingSiteCounter").text(R.length)),c.removeClass("divider"),c.removeClass("topLevelMatchesShadow"),s.addClass("hidden"))},oe=function(){var e=bg.getClearRecentTime(),t=bg.Preferences.get("recentUsedCount"),n=_.getItemChildren().concat(E.getItemChildren());n.sort(VaultItemBaseDisplay.prototype.sortByMostRecent);for(var o=[],a=0,l=n.length;a<l&&a<t;++a){var r=n[a];r.getLastTouchValue()>=e&&o.push(r._model.newDisplayObject())}if(o.length>0){new Container(o,$.extend({},L,{sortFunction:VaultItemBaseDisplay.prototype.sortByMostRecent})).initialize(i)}else me(i)},ie=function(){LPTools.removeDOMChildren(o);for(var e=0,t=x.length;e<t;++e){var n=x[e],i=n.build(L);n.postBuild(i),o.appendChild(i)}if(0===x.length){var a=LPTools.buildEmptyPlaceholder(Strings.translateString("No Matching Results"),"extensionSearchPlaceholder",o);o.appendChild(a)}LPTools.addKeyBoardNavigation(o.children,{rightArrowSelector:".moreItem",selectFirst:!0})},ae=function(){var e=null;return function(t){t.length>0?(A&&(x=D.getSearchResultItems(t),ie()),k||(fe("search",{applyKeyboardNav:!1,onPop:function(){I.val("")}}),k=!0)):e&&e.length>0&&(be(),k=!1),e=t}}(),le=function(t){var n=Strings.translateString("Identities")+" ("+t.getName()+")",o=a.firstChild;3!==o.nodeType?(o=e.createTextNode(n),a.insertBefore(o,a.firstChild)):o.textContent=n},re=function(e,t){return function(){A?t():B[e]=t}},se=function(e){e&&(e.stopPropagation(),e.preventDefault())},ce=function(e){for(var t=null;null!==e&&null===(t=e.getAttribute("childview"));)e=e.parentElement;return t},ue=function(e){return e||(e={}),e.saveOptions={source:"icon"},e},pe=function(e){bg.LPPlatform.openTabDialog("site",ue(e))},de=function(e){bg.LPPlatform.openTabDialog("note",ue(e))},ge=function(e){bg.LPPlatform.openTabDialog("formFill",ue(e))},me=function(e){e.appendChild(LPTools.createElement("li","extensionMenuItem none","None Available"))},fe=function(e,t){H.push(new K.CSSState(e,t))},be=function(){var e=H.pop();e&&e.pop()},ve=dialogs.generatePassword,Pe=function(){ve.getDialog().close(),g.unbind("click",Pe)},he=null,Ie=function(){!0===bg.get("LPContentScriptFeatures").better_generate_password_enabled&&(ve=dialogs.betterGeneratePassword),ve.open({preSetup:function(e){if(null===he){var t=ve.parentElementID,n=e.options.hideHeader,o=e.dynamicHeight;he=function(){ve.parentElementID=t,e.options.hideHeader=n,e.useDynamicHeignt(o)}}ve.parentElementID="extensionDropdownGeneratePassword",e.options.hideHeader=!0,e.useDynamicHeignt(!1)},onClose:function(){be()},onCopy:function(){LPPlatform.closePopup(!0)},saveOptions:{source:"icon"}}),g.unbind("click",Pe),g.bind("click",Pe)},ye=function(e,t,n){if(e.isEmpty()){var o=LPTools.createElement("div","emptyView");o.appendChild(LPTools.createElement("img",{src:"images/vault_4.0/"+t,class:"emptyViewIcon"})),o.appendChild(LPTools.createElement("h1","emptyViewText",n)),document.getElementById("items").appendChild(o)}};I.LP_addSearchHandlers("inputDialog",function(e){ae(e)}),g.bind("click",be),$("[childview]").bind("click",function(e){fe(ce(e.target)),se(e)}),$("#addSite").bind("click",function(e){bg.get_selected_tab_data_no_extension(null,function(e){bg.lpevent("m_add"),pe({defaultData:{url:e?e.url:""}}),LPPlatform.closePopup()}),e.stopPropagation()}),$("#saveAllEnteredData").bind("click",function(){bg.lpevent("m_saed"),bg.saveall()}),$("#addNote").bind("click",function(){bg.lpevent("m_addn"),de()}),$("#addFormFill").bind("click",function(){bg.lpevent("m_af"),ge()}),$("#addCreditCard").bind("click",function(){bg.lpevent("m_af"),ge({defaultData:{profiletype:FormFill.prototype.FORM_FILL_TYPE_CREDIT_CARD}})}),$("#clearForms").bind("click",function(){bg.lpevent("m_clrf"),bg.clearforms("icon")});var Le=null;$("#chooseProfile").bind("click",function(){dialogs.chooseProfile.open({preSetup:function(e){if(null===Le){var t=dialogs.chooseProfile.parentElementID,n=e.options.hideHeader;Le=function(){dialogs.chooseProfile.parentElementID=t,e.options.hideHeader=n,e.$element.css("min-height","")}}e.$element.css("min-height",0),dialogs.chooseProfile.parentElementID="chooseProfileCreditCard",e.options.hideHeader=!0},onClose:function(){be()},saveOptions:{source:"icon"}})}),$("#vaultMenuItem").bind("click",function(){bg.lpevent("m_ov"),bg.openvault()}),$("#sitesMenuItem").bind("click",function(){return re("sites",function(){_.rebuildItems(n),ye(_,"Empty_Site.png",Strings.translateString("Remember every password"))})}()),$("#formFillsMenuItem").bind("click",function(){return re("formFills",function(){w.rebuildItems(n),ye(w,"Empty_Form.png",Strings.translateString("Fill Every Form"))})}()),$("#applicationsMenuItem").bind("click",function(){return re("applications",function(){M.rebuildItems(n),ye(M,"Empty_Site.png",Strings.translateString("Remember every password"))})}()),$("#generateMenuItem").bind("click",Ie),$("#notesMenuItem").bind("click",function(){return re("notes",function(){E.rebuildItems(n),ye(E,"Empty_Note.png",Strings.translateString("Store Every Note"))})}()),$("#clearMostRecent").bind("click",function(){bg.clearrecent(),LPTools.removeDOMChildren(i),me(i)});var Te=re("mostRecent",function(e){F||(oe(),F=!0),LPTools.addKeyBoardNavigation(i.children,{rightArrowSelector:".moreItem",selectFirst:!0})});P.bind("click",Te);var Se=re("matchingSites",function(t){O||(te(r),O=!0),LPTools.addKeyBoardNavigation(e.getElementById("matchingSites").children,{rightArrowSelector:".moreItem",selectFirst:!0})});if(v.bind("click",Se),$("#prefMenuItem").bind("click",function(){bg.lpevent("m_op"),bg.openprefs()}),$("#helpMenuItem").bind("click",function(){bg.lpevent("m_oh"),bg.openhelp()}),$("#adminConsoleMenuItem").bind("click",function(){bg.lpevent("m_oec"),bg.openentconsole()}),$("#logoutMenuItem").bind("click",function(){bg.lpevent("m_lo"),bg.loggedOut(!1,"menu")}),$("#challengeMenuItem").bind("click",function(){bg.lpevent("m_sec"),bg.openseccheck()}),$("#favoritesMenuItem").bind("click",function(){bg.lpevent("m_of"),bg.openfavorites()}),$("#aboutMenuItem").bind("click",function(){bg.lpevent("m_abt"),bg.openabout()}),m.bind("click",function(){bg.lpevent("m_dbgcon"),bg.opendebugtab()}),$("#csvExportMenuItem").bind("click",function(){bg.lpevent("m_e"),bg.openexport()}),$("#formFillExportMenuItem").bind("click",function(){bg.lpevent("m_eff"),bg.formfillexport()}),f.bind("click",function(){bg.lpevent("m_elp"),bg.openlastpassexport()}),b.bind("click",function(){bg.lpevent("m_ewlan"),bg.wlanexport()}),$("#printSitesMenuItem").bind("click",function(){bg.lpevent("m_p"),bg.openprint(!1)}),$("#printNotesMenuItem").bind("click",function(){bg.lpevent("m_pn"),bg.openprint(!0)}),$("#refreshMenuItem").bind("click",function(){bg.lpevent("m_ref"),LPProxy.refreshSites()}),$("#clearCachMenuItem").bind("click",function(){bg.lpevent("m_cl"),bg.clearCache(!1,!0,!1)}),$("#myAccountMenuItem").bind("click",function(){bg.lpevent("m_mya"),bg.openmyaccount()}),$("#sessionsMenuItem").bind("click",function(){bg.lpevent("m_ses"),bg.opensessions()}),LPPlatform.addEventListener(window,"unload",function(){we()}),t.on("click",".extensionMenuItem, .footer",function(){LPPlatform.closePopup()}),LPFeatures.allowGift()){var Ce=$("#specialOfferMenuItem");Ce.show(),Ce.bind("click",function(){bg.openURL(LPProxy.getBaseURL()+"gift.php")})}Topics.get(Topics.PUSH_STATE).subscribe(function(e){H.push(e)}),Topics.get(Topics.EDIT_SITE).subscribe(function(e){e.vaultItem=e.vaultItem.getID(),pe(e)}),Topics.get(Topics.EDIT_NOTE).subscribe(function(e){e.vaultItem=e.vaultItem.getID(),de(e)}),Topics.get(Topics.EDIT_FORM_FILL).subscribe(function(e){e.vaultItem=e.vaultItem.getID(),ge(e)}),Topics.get(Topics.EDIT_APPLICATION).subscribe(function(e){e.vaultItem=e.vaultItem.getID(),bg.LPPlatform.openTabDialog("application",e)}),Topics.get(Topics.IDENTITY_ENABLE).subscribe(function(e){LPProxy.enableIdentity(e),S=e}),Topics.get(Topics.CONFIRM).subscribe(function(e){_e("confirmation",e)}),Topics.get(Topics.ERROR).subscribe(function(e){_e("alert",{title:Strings.Vault.ERROR,text:e})}),Topics.get(Topics.REPROMPT).subscribe(function(e){_e("reprompt",{successCallback:e})}),Topics.get(Topics.LEFT_ARROW).subscribe(function(){LPTools.disableMouse(),be()}),Topics.get(Topics.CLEAR_DATA).subscribe(function(){for(var e=H.length-1;e>-1;--e)H[e].pop();H=[],LPTools.setNavIndex(0),I.val(""),k=!1,A=!1,F=!1,O=!1,N={},B={},R=null,he&&he(),Le&&Le(),h.removeClass("initialized"),Dialog.prototype.closeAllDialogs(!0)}),Topics.get(Topics.INITIALIZED).subscribe(function(){Strings.translate(e.body),W(),LPPlatform.setupDropdownImportMenu(h)});var _e=function(e,t){$("#container").LP_hide(),LPTools.removeKeyBoardNavigation(),t=$.extend(t,{onResize:function(e,t){LPPlatform.setDropdownPopoverSize(e,t)},onClose:function(){LPPlatform.closePopup()}}),LPDialog.openDialog(e,t)},Ee=function(){var e=bg.get("g_badgedata");if(e&&"notification"===e.cmd){switch(e.alerttype){case"duplicate":_e("duplicatePassword",{notification:e});break;case"weak":_e("weakPassword",{notification:e})}switch(e.type){case"error":_e("notification",{notification:bg.get("g_notification_data")})}bg.clear_badge()}else $("#container").LP_show(),G()},we=function(){Topics.get(Topics.CLEAR_DATA).publish()};return{setup:G,State:K,isMatchingSite:ee,setGroupLabel:z,open:Ee,openDialog:_e,reset:we,setBigIcons:function(e){bg.set("g_bigicons",e)}}}(document);